    // ==========================================
    // ARCHETYPE WEIGHTS
    // ==========================================

    async getArchetypeWeights(userId = 'default') {
        if (this.isSQLite) {
            const stmt = this.db.prepare(`
                SELECT archetype, weight, description
                FROM ArchetypeWeights
                WHERE userId = ?
                ORDER BY weight DESC
            `);
            return stmt.all(userId);
        } else {
            // Turso
            const result = await this.db.execute({
                sql: `SELECT archetype, weight, description
                      FROM ArchetypeWeights
                      WHERE userId = ?
                      ORDER BY weight DESC`,
                args: [userId]
            });
            return result.rows;
        }
    }

    async updateArchetypeWeight(userId = 'default', archetype, weight) {
        const id = `aw-${userId}-${archetype}`;
        const now = Date.now();

        if (this.isSQLite) {
            this.db.prepare(`
                INSERT INTO ArchetypeWeights (id, userId, archetype, weight, dateModified)
                VALUES (?, ?, ?, ?, ?)
                ON CONFLICT(userId, archetype) DO UPDATE SET
                    weight = excluded.weight,
                    dateModified = excluded.dateModified
            `).run(id, userId, archetype, weight, now);
            return { success: true };
        } else {
            // Turso - Use INSERT OR REPLACE
            await this.db.execute({
                sql: `INSERT OR REPLACE INTO ArchetypeWeights (id, userId, archetype, weight, dateModified)
                      VALUES (?, ?, ?, ?, ?)`,
                args: [id, userId, archetype, weight, now]
            });
            return { success: true };
        }
    }

    async resetArchetypeWeights(userId = 'default') {
        const DEFAULT_WEIGHTS = [
            { archetype: 'combinazioni_db', weight: 30, description: 'Combinazioni salvate nel database' },
            { archetype: 'classica', weight: 28, description: 'Margherita, Marinara style' },
            { archetype: 'tradizionale', weight: 21, description: 'Prosciutto, Funghi, Capricciosa' },
            { archetype: 'terra_bosco', weight: 7, description: 'Funghi porcini, tartufo' },
            { archetype: 'fresca_estiva', weight: 7, description: 'Verdure, pomodorini' },
            { archetype: 'piccante_decisa', weight: 4, description: 'Nduja, peperoncino' },
            { archetype: 'mare', weight: 2, description: 'Pesce, frutti di mare' },
            { archetype: 'vegana', weight: 1, description: 'Solo vegetali' }
        ];

        const now = Date.now();

        if (this.isSQLite) {
            // Delete existing weights for user
            this.db.prepare('DELETE FROM ArchetypeWeights WHERE userId = ?').run(userId);

            // Insert defaults
            const stmt = this.db.prepare(`
                INSERT INTO ArchetypeWeights (id, userId, archetype, weight, description, dateModified)
                VALUES (?, ?, ?, ?, ?, ?)
            `);

            DEFAULT_WEIGHTS.forEach(w => {
                const id = `aw-${userId}-${w.archetype}`;
                stmt.run(id, userId, w.archetype, w.weight, w.description, now);
            });

            return { success: true, count: DEFAULT_WEIGHTS.length };
        } else {
            // Turso - Delete and insert
            await this.db.execute({
                sql: 'DELETE FROM ArchetypeWeights WHERE userId = ?',
                args: [userId]
            });

            // Insert all defaults
            for (const w of DEFAULT_WEIGHTS) {
                const id = `aw-${userId}-${w.archetype}`;
                await this.db.execute({
                    sql: `INSERT INTO ArchetypeWeights (id, userId, archetype, weight, description, dateModified)
                          VALUES (?, ?, ?, ?, ?, ?)`,
                    args: [id, userId, w.archetype, w.weight, w.description, now]
                });
            }

            return { success: true, count: DEFAULT_WEIGHTS.length };
        }
    }
}
